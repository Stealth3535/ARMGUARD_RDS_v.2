#!/usr/bin/env python3\n\"\"\"\nQuick test to verify QR code generation in registration success page\n\"\"\"\n\nimport os\nimport sys\nimport django\n\n# Setup Django environment\nsys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings')\ndjango.setup()\n\n# Test QR code generation\nfrom utils.qr_generator import generate_qr_code_to_buffer\nimport base64\n\ndef test_qr_generation():\n    \"\"\"Test QR code generation function\"\"\"\n    print(\"Testing QR Code Generation...\")\n    \n    try:\n        # Test with sample personnel data\n        test_data = \"PERSONNEL:PE-123456:CPT Smith, John:123456:testuser\"\n        \n        print(f\"Generating QR for: {test_data}\")\n        buffer = generate_qr_code_to_buffer(test_data, size=600)\n        qr_base64 = base64.b64encode(buffer.getvalue()).decode()\n        \n        print(f\"QR Code generated successfully!\")\n        print(f\"Base64 length: {len(qr_base64)} characters\")\n        print(f\"First 50 chars: {qr_base64[:50]}...\")\n        \n        return True\n        \n    except Exception as e:\n        print(f\"❌ Error generating QR code: {e}\")\n        return False\n\ndef test_session_data():\n    \"\"\"Test session data handling\"\"\"\n    print(\"\\nTesting Session Data Handling...\")\n    \n    # Test basic session functionality\n    from django.contrib.sessions.backends.db import SessionStore\n    session = SessionStore()\n    \n    # Test storing QR code in session\n    test_qr = \"iVBORw0KGgoAAAANSUhEUgAAABQAAAAU\"  # Sample base64\n    session['qr_code'] = test_qr\n    session['personnel_name'] = \"CPT Smith, John\"\n    session.save()\n    \n    print(f\"Session created: {session.session_key}\")\n    print(f\"QR Code stored: {len(session['qr_code'])} chars\")\n    print(f\"Personnel name: {session['personnel_name']}\")\n    \n    # Test retrieval\n    retrieved_qr = session.pop('qr_code', None)\n    retrieved_name = session.pop('personnel_name', None)\n    \n    print(f\"Retrieved QR: {retrieved_qr is not None}\")\n    print(f\"Retrieved name: {retrieved_name}\")\n    \n    return True\n\nif __name__ == '__main__':\n    print(\"Registration Success QR Code Test\")\n    print(\"=\" * 40)\n    \n    # Run tests\n    qr_test = test_qr_generation()\n    session_test = test_session_data()\n    \n    if qr_test and session_test:\n        print(\"\\n✅ All tests passed! QR code functionality should work.\")\n        print(\"\\nIf QR codes still don't show on the success page, check:\")\n        print(\"1. Registration view is storing QR code in session\")\n        print(\"2. Session middleware is configured correctly\")\n        print(\"3. No errors in browser console\")\n    else:\n        print(\"\\n❌ Some tests failed. Check the errors above.\")\n
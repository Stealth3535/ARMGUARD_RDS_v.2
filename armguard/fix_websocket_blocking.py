#!/usr/bin/env python3\n\"\"\"\nQuick fix for WebSocket blocking issues\nThis script will temporarily disable WebSocket functionality to get the web interface working again.\n\"\"\"\n\nimport os\nimport sys\n\ndef fix_websocket_blocking():\n    \"\"\"Apply quick fix for WebSocket blocking issues\"\"\"\n    \n    # Path to notifications.py\n    notifications_path = \"c:/Users/9533RDS/Desktop/ARMGUARD_RDS_v.2/armguard/core/notifications.py\"\n    \n    try:\n        # Read the file\n        with open(notifications_path, 'r', encoding='utf-8') as f:\n            content = f.read()\n        \n        # Check if already fixed\n        if \"# TEMPORARY FIX\" in content:\n            print(\"‚úÖ WebSocket notifications already disabled\")\n            return True\n            \n        # Add early return to disable WebSocket notifications\n        original = '''def send_user_notification(user_id, title, message, level='info', data=None):\n    \"\"\"\n    Send real-time notification to a specific user\n    \n    Args:\n        user_id: Target user ID\n        title: Notification title\n        message: Notification message\n        level: 'info', 'success', 'warning', 'error'\n        data: Optional additional data dict\n    \"\"\"\n    try:'''\n        \n        replacement = '''def send_user_notification(user_id, title, message, level='info', data=None):\n    \"\"\"\n    Send real-time notification to a specific user\n    \n    Args:\n        user_id: Target user ID\n        title: Notification title\n        message: Notification message\n        level: 'info', 'success', 'warning', 'error'\n        data: Optional additional data dict\n    \"\"\"\n    # TEMPORARY FIX: Disable WebSocket notifications to prevent blocking\n    logger.debug(f\"WebSocket notification disabled (would send to user {user_id}): {title}\")\n    return\n    \n    try:'''\n        \n        # Apply the fix\n        new_content = content.replace(original, replacement)\n        \n        if new_content != content:\n            # Backup original\n            with open(notifications_path + '.backup', 'w', encoding='utf-8') as f:\n                f.write(content)\n            \n            # Write fixed version\n            with open(notifications_path, 'w', encoding='utf-8') as f:\n                f.write(new_content)\n            \n            print(\"‚úÖ WebSocket notifications disabled\")\n            print(\"üìÑ Original file backed up as notifications.py.backup\")\n            return True\n        else:\n            print(\"‚ùå Could not find the function to fix\")\n            return False\n            \n    except Exception as e:\n        print(f\"‚ùå Error applying fix: {e}\")\n        return False\n\ndef create_restore_script():\n    \"\"\"Create a script to restore WebSocket functionality later\"\"\"\n    \n    restore_script = '''\n@echo off\necho Restoring WebSocket functionality...\n\n:: Check if backup exists\nif not exist \"core/notifications.py.backup\" (\n    echo Error: Backup file not found!\n    echo WebSocket functionality may not have been disabled properly.\n    pause\n    exit /b 1\n)\n\n:: Restore from backup\ncopy \"core\\\\notifications.py.backup\" \"core\\\\notifications.py\"\necho WebSocket notifications restored from backup.\n\n:: Note about consumers.py\necho Note: You also need to manually restore the consumers.py file\necho by uncommenting the disabled code in core/consumers.py\n\necho.\necho Restart the Django server after making these changes.\npause\n'''\n    \n    with open(\"c:/Users/9533RDS/Desktop/ARMGUARD_RDS_v.2/armguard/restore_websockets.bat\", 'w') as f:\n        f.write(restore_script)\n    \n    print(\"üìù Created restore_websockets.bat for later restoration\")\n\nif __name__ == '__main__':\n    print(\"WebSocket Blocking Fix\")\n    print(\"=\" * 30)\n    print(\"This will temporarily disable WebSocket functionality...\")\n    print()\n    \n    # Apply the fix\n    success = fix_websocket_blocking()\n    \n    if success:\n        create_restore_script()\n        print()\n        print(\"üéØ NEXT STEPS:\")\n        print(\"1. Restart the Django development server (Ctrl+C then 'python manage.py runserver')\")\n        print(\"2. The web interface should now work without WebSocket blocking\")\n        print(\"3. To restore WebSocket functionality later, run restore_websockets.bat\")\n        print(\"4. For production, consider setting up Redis for proper WebSocket support\")\n    else:\n        print(\"‚ùå Could not apply the fix automatically\")\n        print(\"Manual fix: Add 'return' as the first line in send_user_notification() function\")\n
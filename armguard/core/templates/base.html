{% load static %}
{% load user_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ArmGuard - Armory Management System{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/realtime.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    {% if user.is_authenticated %}
    <!-- Header Actions Bar -->
    <div class="header-actions no-print bg-white border-b">
        <div class="container flex justify-between align-center py-3">
            <div class="welcome-text text-sm text-neutral-600">
                Welcome, <span class="font-semibold text-neutral-900">{{ user.username }}</span> | Role: <span class="badge badge-primary">{{ user|get_user_role }}</span>
            </div>
            <a href="{% url 'logout' %}" class="btn btn-secondary btn-sm">Logout</a>
        </div>
    </div>

    <div class="no-print">
        {% include 'includes/navbar.html' %}
    </div>
    {% endif %}
    
    {% block global_messages %}
    <!-- Messages -->
    {% if messages %}
    <div class="container mt-6">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} mb-4" role="alert">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endblock %}

    <main class="container">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    <footer class="footer no-print">
        <p>&copy; 2025 ArmGuard - Armory Management System</p>
        <p>Developed by 9533 R&D Squadron for Philippine Air Force | Military Time: <span id="digital-clock"></span></p>
    </footer>

    <script src="{% static 'js/main.js' %}"></script>
    
    <!-- Real-time Features (Only load on dashboard/monitoring pages) -->
    {% if user.is_authenticated and enable_realtime|default:False %}
    <script>
        // Pass authentication status to JavaScript
        var userAuthenticated = true;
        var userId = {{ user.id }};
    </script>
    <script src="{% static 'js/websocket-manager.js' %}" defer></script>
    <script src="{% static 'js/notifications.js' %}" defer></script>
    <script src="{% static 'js/live-feed.js' %}" defer></script>
    {% endif %}
    
        <script>
            function updateClock() {
                const now = new Date();
                const day = String(now.getDate()).padStart(2, '0');
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const year = String(now.getFullYear()).slice(-2);
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                const formatted = `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
                document.getElementById('digital-clock').textContent = formatted;
            }
            setInterval(updateClock, 1000);
            updateClock();
        </script>
    {% block extra_js %}{% endblock %}
</body>
</html>


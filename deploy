#!/bin/bash

# =============================================================================
# ğŸ¯ ARMGUARD ONE SYSTEMATIZED DEPLOYMENT
# =============================================================================
# Single entry point for all ArmGuard deployment needs
# Version: 4.0.0
# =============================================================================

set -e

# Colors for output
readonly GREEN='\033[0;32m'
readonly BLUE='\033[0;34m'  
readonly YELLOW='\033[1;33m'
readonly RED='\033[0;31m'
readonly WHITE='\033[1;37m'
readonly NC='\033[0m'

# Script location detection
readonly SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
readonly SYSTEMATIZED_DEPLOYMENT="$SCRIPT_DIR/armguard/deployment/systematized-deploy.sh"

print_welcome() {
    clear
    echo -e "${BLUE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${BLUE}â•‘                                                                             â•‘${NC}"
    echo -e "${BLUE}â•‘               ${WHITE}ğŸ¯ SINGLE SYSTEMATIZED ARMGUARD DEPLOYMENT${BLUE}                â•‘${NC}"
    echo -e "${BLUE}â•‘                                                                             â•‘${NC}"
    echo -e "${BLUE}â•‘    ${GREEN}One Command â€¢ Complete System â€¢ All Capabilities Integrated${BLUE}         â•‘${NC}"
    echo -e "${BLUE}â•‘                                                                             â•‘${NC}"
    echo -e "${BLUE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
}

check_system() {
    echo -e "${YELLOW}System Check:${NC}"
    
    # Check if systematized deployment exists
    if [ -f "$SYSTEMATIZED_DEPLOYMENT" ]; then
        echo -e "${GREEN}  âœ… Systematized deployment system ready${NC}"
    else
        echo -e "${RED}  âŒ Systematized deployment system not found${NC}"
        echo -e "${RED}     Expected: $SYSTEMATIZED_DEPLOYMENT${NC}"
        exit 1
    fi
    
    # Make sure it's executable
    chmod +x "$SYSTEMATIZED_DEPLOYMENT"
    
    echo ""
}

show_quick_help() {
    echo -e "${WHITE}ğŸ“‹ Quick Usage:${NC}"
    echo ""
    echo -e "${GREEN}  Interactive Mode:${NC}"
    echo -e "${BLUE}    ./deploy${NC}"
    echo ""
    echo -e "${GREEN}  Direct Deployment:${NC}"
    echo -e "${BLUE}    ./deploy quick-dev${NC}        ${YELLOW}# Development setup with conflict resolution${NC}"
    echo -e "${BLUE}    ./deploy production-full${NC}  ${YELLOW}# Complete enterprise production${NC}"
    echo -e "${BLUE}    ./deploy redis-only${NC}       ${YELLOW}# WebSocket performance optimization${NC}"
    echo -e "${BLUE}    ./deploy system-repair${NC}    ${YELLOW}# Fix conflicts and issues${NC}"
    echo ""
    echo -e "${GREEN}  Help:${NC}"  
    echo -e "${BLUE}    ./deploy help${NC}             ${YELLOW}# Show all options${NC}"
    echo ""
}

main() {
    print_welcome
    check_system
    
    if [ $# -eq 0 ]; then
        show_quick_help
        echo -e "${YELLOW}Press Enter to launch interactive deployment, or Ctrl+C to exit...${NC}"
        read
    fi
    
    echo -e "${GREEN}ğŸš€ Launching systematized deployment...${NC}"
    echo ""
    
    # Execute the systematized deployment with all arguments
    exec bash "$SYSTEMATIZED_DEPLOYMENT" "$@"
}

# Execute main function with all arguments  
main "$@"
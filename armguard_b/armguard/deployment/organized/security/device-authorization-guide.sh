#!/bin/bash

################################################################################
# ArmGuard Device Authorization Guide
# Shows how to register and authorize different types of devices
################################################################################

echo "üîê ArmGuard Device Authorization Methods"
echo "========================================"
echo ""

# Get current system info
LAN_IP=$(hostname -I | cut -d' ' -f1)

echo "üìã Your ArmGuard System Info:"
echo "  ‚Ä¢ Server IP: $LAN_IP"
echo "  ‚Ä¢ Admin Panel: http://$LAN_IP/admin"
echo "  ‚Ä¢ Main Interface: http://$LAN_IP"
echo ""

echo "üñ•Ô∏è  DEVICE AUTHORIZATION METHODS:"
echo ""

echo "1Ô∏è‚É£  LAN DEVICES (Local Network Access)"
echo "======================================="
echo "For PCs on your local network (192.168.x.x):"
echo ""
echo "‚Ä¢ ‚úÖ AUTOMATIC: All devices on LAN (192.168.x.x) are pre-authorized"
echo "‚Ä¢ ‚úÖ FULL ACCESS: Can perform all armory transactions"
echo "‚Ä¢ ‚úÖ NO SETUP NEEDED: Just browse to http://$LAN_IP"
echo ""
echo "Examples of authorized LAN devices:"
echo "  - Armory Desktop PC: 192.168.0.100"
echo "  - Office Laptop: 192.168.0.150"  
echo "  - Admin Workstation: 192.168.0.200"
echo ""

echo "2Ô∏è‚É£  VPN REMOTE DEVICES (Secure Remote Access)"
echo "=============================================="
echo "For remote devices that need secure access:"
echo ""
echo "Generate VPN client configurations:"
echo "  cd /home/armguard/armguard/deployment"
echo "  sudo ./rpi4b-generate-client.sh device-name role"
echo ""
echo "Available roles:"
echo "  ‚Ä¢ commander  - Full inventory viewing, reports, user management"
echo "  ‚Ä¢ armorer    - Equipment inventory, maintenance reports" 
echo "  ‚Ä¢ emergency  - Critical equipment access only"
echo "  ‚Ä¢ personnel  - Personal transaction history only"
echo ""
echo "Example commands:"
echo "  sudo ./rpi4b-generate-client.sh johns-laptop commander"
echo "  sudo ./rpi4b-generate-client.sh office-tablet armorer"
echo "  sudo ./rpi4b-generate-client.sh mobile-phone personnel"
echo ""

echo "3Ô∏è‚É£  USER ACCOUNT REGISTRATION"
echo "=============================="
echo "Create user accounts in Django admin:"
echo ""
echo "1. Visit: http://$LAN_IP/admin"
echo "2. Log in with superuser account"
echo "3. Go to 'Users' section"
echo "4. Click 'Add User'"
echo "5. Fill in user details and permissions"
echo ""

echo "4Ô∏è‚É£  DEVICE MAC ADDRESS AUTHORIZATION (Advanced)"
echo "==============================================="
echo "For strict device control, you can:"
echo ""
echo "1. Get device MAC address: ipconfig /all (Windows) or ifconfig (Linux)"
echo "2. Add to authorized devices list in Django admin"
echo "3. Configure network middleware to check MAC addresses"
echo ""

echo ""
echo "üîß QUICK SETUP EXAMPLES:"
echo "========================"
echo ""

echo "A) Register Office PC for LAN access:"
echo "   ‚Ä¢ No setup needed - just use http://$LAN_IP"
echo "   ‚Ä¢ Create user account in admin panel"
echo ""

echo "B) Register Remote Laptop with VPN:"
echo "   sudo ./rpi4b-generate-client.sh office-laptop commander"
echo "   ‚Ä¢ Install WireGuard on laptop"
echo "   ‚Ä¢ Import generated .conf file"
echo "   ‚Ä¢ Access via http://10.0.0.1"
echo ""

echo "C) Register Mobile Device:"
echo "   sudo ./rpi4b-generate-client.sh phone-admin personnel"
echo "   ‚Ä¢ Install WireGuard app"
echo "   ‚Ä¢ Scan generated QR code"
echo "   ‚Ä¢ Limited access via VPN"
echo ""

echo ""
echo "üì± STEP-BY-STEP DEVICE REGISTRATION:"
echo "===================================="
echo ""

# Create superuser if needed
echo "Step 1: Create admin account (if not done yet)"
echo "   cd /opt/armguard"
echo "   source venv/bin/activate" 
echo "   python manage.py createsuperuser"
echo ""

echo "Step 2: Log into admin panel"
echo "   Visit: http://$LAN_IP/admin"
echo "   Use superuser credentials"
echo ""

echo "Step 3: Register devices based on access type"
echo "   ‚Ä¢ LAN devices: Create user accounts only"
echo "   ‚Ä¢ VPN devices: Generate VPN configs + create user accounts"
echo ""

echo "Step 4: Test access"
echo "   ‚Ä¢ LAN: Direct access to http://$LAN_IP"
echo "   ‚Ä¢ VPN: Connect VPN, then access http://10.0.0.1"
echo ""

echo "üõ°Ô∏è  SECURITY LEVELS:"
echo "===================="
echo ""
echo "üî¥ HIGH SECURITY (LAN Only):"
echo "   ‚Ä¢ Physical network access required"
echo "   ‚Ä¢ Full transaction capabilities"
echo "   ‚Ä¢ No remote access"
echo ""
echo "üü° MEDIUM SECURITY (VPN):"  
echo "   ‚Ä¢ Encrypted remote access"
echo "   ‚Ä¢ Role-based permissions"
echo "   ‚Ä¢ Read-only for most operations"
echo ""
echo "üü¢ BASIC SECURITY (WAN - if enabled):"
echo "   ‚Ä¢ Internet access"  
echo "   ‚Ä¢ Read-only status checking only"
echo "   ‚Ä¢ Limited functionality"
echo ""

echo ""
echo "üí° RECOMMENDATIONS:"
echo "===================="
echo ""
echo "For Military/Secure Environment:"
echo "  ‚úÖ Use LAN access for all armory transactions"
echo "  ‚úÖ Use VPN only for status monitoring"
echo "  ‚úÖ Create separate user accounts for each person"
echo "  ‚úÖ Regularly rotate VPN client certificates"
echo ""

echo "Next steps to register your first device:"
echo "1. Create superuser: cd /opt/armguard && source venv/bin/activate && python manage.py createsuperuser"
echo "2. Access admin: http://$LAN_IP/admin"
echo "3. Add users and generate VPN configs as needed"
echo ""

echo "For VPN client generation, run:"
echo "cd /home/armguard/armguard/deployment && sudo ./rpi4b-generate-client.sh device-name role"
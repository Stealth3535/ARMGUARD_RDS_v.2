# Logrotate configuration for ArmGuard
# This file should be copied to /etc/logrotate.d/armguard

/var/log/armguard/*.log {
    # Rotate logs daily
    daily
    
    # Keep 14 days of logs
    rotate 14
    
    # Don't error if log file is missing
    missingok
    
    # Don't rotate if log is empty
    notifempty
    
    # Compress old log files
    compress
    
    # Delay compression until next rotation (so current files aren't compressed)
    delaycompress
    
    # Create new log files with these permissions
    create 0640 www-data www-data
    
    # Use date as suffix for rotated files
    dateext
    dateformat -%Y%m%d
    
    # Shared scripts for all logs
    sharedscripts
    
    # After rotation, reload Gunicorn gracefully to reopen log files
    postrotate
        systemctl reload gunicorn-armguard > /dev/null 2>&1 || true
    endscript
}

# Nginx logs specific to ArmGuard
/var/log/nginx/armguard_*.log {
    daily
    rotate 14
    missingok
    notifempty
    compress
    delaycompress
    create 0640 www-data adm
    dateext
    dateformat -%Y%m%d
    sharedscripts
    
    postrotate
        # Reload Nginx to reopen log files
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 $(cat /var/run/nginx.pid) > /dev/null 2>&1 || true
        fi
    endscript
}
